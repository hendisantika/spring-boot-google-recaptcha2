<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>Create Employee</title>

    <link crossorigin="anonymous" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
          rel="stylesheet" th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css}">

</head>
<body>

<div class="container">
    <h1 class="text-center mt-4">User Management</h1>

    <form id="employeeForm" method="post" th:action="@{/create/process}" th:object="${employee}">

        <div class="mb-3">
            <label class="form-label" for="name">First Name</label>
            <input class="form-control" id="name" name="name" required th:field="*{name}" type="text"/>
        </div>
        <div class="mb-3">
            <label class="form-label" for="lastName">Last name</label>
            <input class="form-control" id="lastName" name="lastName" required th:field="*{lastName}" type="text"/>
        </div>
        <div class="mb-3">
            <label class="form-label" for="dateOfBirth">Birthdate</label>
            <input class="form-control" id="dateOfBirth" name="dateOfBirth" required th:field="*{dateOfBirth}"
                   type="date"/>
        </div>

        <!-- Hidden input to store reCAPTCHA token -->
        <input id="g-recaptcha-response" name="g-recaptcha-response" type="hidden"/>

        <button class="btn btn-primary mt-2" id="submitBtn" type="submit">Submit</button>
        <a class="btn btn-danger mt-2" th:href="@{/}">Cancel</a>

        <div class="alert alert-info mt-3">
            <small>
                <i class="bi bi-shield-check"></i>
                This site is protected by reCAPTCHA v3 and the Google
                <a href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a> and
                <a href="https://policies.google.com/terms" target="_blank">Terms of Service</a> apply.
            </small>
        </div>
    </form>

</div>

<script crossorigin="anonymous"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js}"></script>

<!-- Load reCAPTCHA v3 API -->
<script th:src="@{'https://www.google.com/recaptcha/api.js?render=' + ${recaptchaSiteKey}}"></script>

<script th:inline="javascript">
    // reCAPTCHA v3 implementation
    const SITE_KEY = /*[[${recaptchaSiteKey}]]*/ '';

    document.getElementById('employeeForm').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent default form submission

        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...';

        // Execute reCAPTCHA v3
        grecaptcha.ready(function () {
            grecaptcha.execute(SITE_KEY, {action: 'submit'}).then(function (token) {
                // Add the token to the form
                document.getElementById('g-recaptcha-response').value = token;

                // Submit the form
                document.getElementById('employeeForm').submit();
            }).catch(function (error) {
                console.error('reCAPTCHA error:', error);
                alert('reCAPTCHA verification failed. Please try again.');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit';
            });
        });
    });
</script>

</body>
</html>
